type Account @entity {
  id: ID!
  accountId: BigInt!
  address: String!
  recoveryAddress: String!
  metadata: String!
  username: String

  ownedNodes: [Node!]! @derivedFrom(field: "owner")

  createdAtTimestamp: BigInt!
  createdAtTransaction: Bytes!
}

enum NodeType {
  UNKNOWN
  METALABEL
  SQUAD
  RELEASE
  DROP
  TREASURY
  SPLIT
  REALM
}

type Node @entity {
  id: ID!
  nodeId: BigInt!
  nodeType: NodeType!
  metadata: String!
  owner: Account
  parent: Node
  accessNode: Node

  catalogs: [Catalog!]! @derivedFrom(field: "controlNode")
  children: [Node!]! @derivedFrom(field: "parent")
  accessChildren: [Node!]! @derivedFrom(field: "accessNode")
  authorizedNodeManagers: [AuthorizedNodeManager!]! @derivedFrom(field: "node")
  sequences: [Sequence!]! @derivedFrom(field: "dropNode")
  records: [Record!]! @derivedFrom(field: "dropNode")

  catalogCount: Int!
  childrenCount: Int!
  accessChildrenCount: Int!
  authorizedNodeManagerCount: Int!
  sequenceCount: Int!
  recordCount: Int!

  createdAtTimestamp: BigInt!
  createdAtTransaction: Bytes!
}

type AuthorizedNodeManager @entity {
  id: ID!
  node: Node!
  address:  String!

  createdAtTimestamp: BigInt!
  createdAtTransaction: Bytes!
}

type Catalog @entity {
  id: ID!
  address: String!
  name: String!
  symbol: String!
  ownerAddress: String!
  controlNode: Node!

  createdAtTimestamp: BigInt!
  createdAtTransaction: Bytes!

  recordCount: Int!
  sequenceCount: Int!

  records: [Record!]! @derivedFrom(field: "catalog")
  sequences: [Sequence!]! @derivedFrom(field: "catalog")
}

type Record @entity {
  id: ID!
  tokenId: BigInt!
  sequence: Sequence!
  etching: String!
  ownerAddress: String!
  data: BigInt!

  catalog: Catalog! # denormalized, sequence -> catalog
  dropNode: Node! # denormalized, sequence -> dropNode

  createdAtTimestamp: BigInt!
  createdAtTransaction: Bytes!
}

type Sequence @entity {
  id: ID!
  catalog: Catalog!
  sequenceId: Int!
  dropNode: Node!
  engineAddress: String!
  maxSupply: BigInt # null if none
  sealedBeforeTimestamp: BigInt!
  sealedAfterTimestamp: BigInt!
  engineData: String!

  createdAtTimestamp: BigInt!
  createdAtTransaction: Bytes!

  recordCount: Int!

  records: [Record!]! @derivedFrom(field: "sequence")
}
